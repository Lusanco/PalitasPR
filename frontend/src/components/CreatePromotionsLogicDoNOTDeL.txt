import UploadImage from "./UploadImage.svelte";
  import { onMount, afterUpdate } from "svelte";
  import { link } from "svelte-routing";
  import axios from "axios";
  import LoadingSpinnerFull from "./LoadingSpinnerFull.svelte";
  import townsID from "../townsID";
  import servicesID from "../servicesID";
  import Button from "./Button.svelte";

  let errorMessage;

  // Data points for data
  let model = "Promotion",
    title,
    town,
    serviceID,
    description,
    priceMin,
    priceMax;

  // For iterating town and service name and ids
  const towns = Object.entries(townsID);
  const services = Object.entries(servicesID);

  let hidden = true;
  let loaded = false;
  let reload = false;
  let error = false;

  let data = {
    model: model,
    title: title,
    town: town,
    service_id: serviceID,
    description: description,
    price_min: priceMin,
    price_max: priceMax,
  };

  function createLogic() {
    hidden = false;
    loaded = false;
    reload = true;
    error = false;

    axios
      .post("/api/dashboard/promotion-request", data)
      .then((response) => {
        loaded = true;
        reload = false;
        error = false;
        console.log(response);
        // if (response.status === 201) {
        //   window.location.href = "/success";
        // }
      })
      .catch((err) => {
        hidden = false;
        loaded = true;
        reload = false;
        error = true;
        console.log(err);
        errorMessage = err;
      });
  }

  async function handleCreate() {
    createLogic();
    // handleUpload();
  }

  onMount(() => {
    errorMessage = ""; // Clear any previous error messages on component mount
  });